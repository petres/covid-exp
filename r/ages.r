# ------------------------------------------------------------------------------
# INIT
# ------------------------------------------------------------------------------
rm(list = ls())
source('r/_shared.r', encoding = 'UTF-8')
library(ggplot2)
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# LOAD / PREPARE
# ------------------------------------------------------------------------------
d.raw = fread(g$u$cases.ages)
d = d.raw[Bundesland == 'Ã–sterreich', .(
    d = as.Date(Time, format="%d.%m.%Y"),
    n = AnzahlFaelle
)]
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# MEAN
# ------------------------------------------------------------------------------
meanDays = 7
d[, n7 := (cumsum(n) - shift(cumsum(n), meanDays, fill = 0))/meanDays]
d[, n7g := sqrt((shift(n7, -2) + shift(n7, -1) + n7)/(n7 + shift(n7, 1) + shift(n7, 2)))]
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# OUTPUT
# ------------------------------------------------------------------------------
l = nrow(d)
d[l, ]

# ggplot(d, aes(x = d, y = n7)) + geom_line()
# ggplot(d[d > '2020-04-01'], aes(x = d, y = n7g)) + geom_line()
fwrite(d, g$f$cases.out)
# ------------------------------------------------------------------------------
